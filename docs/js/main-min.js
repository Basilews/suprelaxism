const pictureList=[{id:"id0",author:"Kazimir Malevich",date:"1915",description:"Red square and black square",figures:[{speed:10},{speed:20}]},{id:"id1",author:"Nadezhda Udaltsova",date:"1916",description:"Unnamed",figures:[{speed:10},{speed:25},{speed:25},{speed:15},{speed:10}]}],gallery=document.getElementsByClassName("gallery")[0],canvas=document.getElementsByClassName("pictures")[0],resetBtn=document.getElementsByClassName("reset")[0],checkbox=document.getElementById("mode"),superModeToggle=document.getElementById("super");gallery.addEventListener("click",e=>{if("previewContainer"===e.target.parentElement.className){const t=parseInt(e.target.parentElement.id,10),i=document.getElementsByClassName("pictureContainer")[0],{offsetTop:s}=i;new Picture(pictureList[t]),window.scrollTo(0,s)}});class Picture{constructor(e){this.figures=new Array(e.figures.length),this.perspective=1e3,this.x=0,this.y=0,this.drawPicture(e),this.picture=document.getElementById(e.id),this.deviceParallax=this.deviceParallax.bind(this),this.deviceTilt=this.deviceTilt.bind(this),this.parallax=this.parallax.bind(this),this.tiltPicture=this.tiltPicture.bind(this),this.parallaxAndTilt=this.parallaxAndTilt.bind(this),this.setMode=this.setMode.bind(this),this.onSuperModeToggle=this.onSuperModeToggle.bind(this),this.reset=this.reset.bind(this),superModeToggle.checked?this.setMode({super:"on"}):this.setMode({target:{checked:checkbox.checked}}),checkbox.addEventListener("change",this.setMode),superModeToggle.addEventListener("change",this.onSuperModeToggle),resetBtn.addEventListener("click",this.reset)}onSuperModeToggle(e){e.target.checked?(checkbox.disabled=!0,this.setMode({super:"on"})):(checkbox.disabled=!1,this.setMode({super:"off"}))}parallaxAndTilt(e){const{clientX:t,clientY:i}=e;if(!this.x&&!this.y)return this.x=t,void(this.y=i);this.figures.forEach(t=>{const{xPos:i,yPos:s}=this.findCoordinates(t,e,75),r=Math.ceil(t.speed/2);t.el.style.transform=`translate3d(${i}px, ${s}px, ${50+r}px)`}),this.setTransform(e)}setMode(e){"on"===e.super?(checkbox.checked?this.picture.removeEventListener("mousemove",this.tiltPicture):(this.picture.classList.add("tilt"),window.removeEventListener("mousemove",this.parallax)),this.picture.addEventListener("mousemove",this.parallaxAndTilt)):"off"===e.super?(checkbox.checked?(window.removeEventListener("mousemove",this.parallax),this.picture.addEventListener("mousemove",this.tiltPicture,{passive:!0})):(this.picture.classList.remove("tilt"),this.picture.removeEventListener("mousemove",this.tiltPicture),window.addEventListener("mousemove",this.parallax)),this.picture.removeEventListener("mousemove",this.parallaxAndTilt)):e.target.checked?(this.picture.classList.add("tilt"),window.removeEventListener("mousemove",this.parallax),this.picture.addEventListener("mousemove",this.tiltPicture,{passive:!0}),window.DeviceMotionEvent&&(window.removeEventListener("devicemotion",this.deviceParallax),window.addEventListener("devicemotion",this.deviceTilt,{passive:!0}))):(this.picture.classList.remove("tilt"),this.picture.removeEventListener("mousemove",this.tiltPicture),window.addEventListener("mousemove",this.parallax,{passive:!0}),window.DeviceMotionEvent&&(window.removeEventListener("devicemotion",this.deviceTilt),window.addEventListener("devicemotion",this.deviceParallax,{passive:!0})))}deviceParallax(e){const t=e.rotationRate.beta.toPrecision(2),i=e.rotationRate.alpha.toPrecision(2);this.x+=parseFloat(t),this.y+=parseFloat(i);const s=this.x,r=this.y;requestAnimationFrame(()=>this.moveObjects({clientX:s,clientY:r,isGyro:!0}))}deviceTilt(e){const t=e.rotationRate.beta.toPrecision(2),i=e.rotationRate.alpha.toPrecision(2);this.x+=parseFloat(t),this.y+=parseFloat(i);const s=this.x,r=this.y;requestAnimationFrame(()=>this.tiltPicture({clientX:s,clientY:r,isGyro:!0}))}drawPicture(e){canvas.innerHTML=`\n      <li class="pictureContainer">\n        <div class="description">\n          <p class="name">«${e.description}»</p>\n          <p class="author">${e.author}, ${e.date}</p>\n        </div>\n        <div id="${e.id}" class="picture">\n          ${e.figures.map((e,t)=>`<div class="fig${t} figure"></div>`)}\n        </div>\n      </li>\n    `,e.figures.forEach((e,t)=>{const i=document.getElementsByClassName(`fig${t}`)[0];this.figures[t]={el:i,speed:e.speed}})}findCoordinates(e,t,i){return{xPos:t.isGyro?-t.clientX*e.speed/i:(this.x-t.clientX)*e.speed/i,yPos:t.isGyro?-t.clientY*e.speed/i:(this.y-t.clientY)*e.speed/i}}findCenterCoordinates(){return[this.picture.offsetLeft+this.picture.offsetWidth/2,this.picture.offsetTop+this.picture.offsetHeight/2]}parallax(e){requestAnimationFrame(()=>this.moveObjects(e))}moveObjects(e){const t=e.isGyro?800:300;if(!e.isGyro&&!this.x&&!this.y)return this.x=e.clientX,void(this.y=e.clientY);this.figures.forEach(i=>{const{xPos:s,yPos:r}=this.findCoordinates(i,e,t);i.el.style.transform=`translate3d(${s}px, ${r}px, 0)`})}tiltPicture(e){this.setTransform(e),this.figures.forEach(e=>{e.el.style.transform=`translateZ(${3*e.speed}px)`})}setTransform(e){const{clientX:t,clientY:i}=e,s=e.isGyro?100:15,[r,o]=this.findCenterCoordinates();let n=-(o-i)/s;const a=(r-t)/s;e.isGyro&&(n=-n);const c=document.getElementById(this.picture.id),d="rtl"===window.getComputedStyle(c,null).getPropertyValue("direction");this.picture.style.transform=d?`perspective(${this.perspective}px) rotateX(${n}deg) rotateY(${a}deg) scale(0.7)`:`perspective(${this.perspective}px) rotateX(${n}deg) rotateY(${a}deg)`}reset(){this.picture.style.transform=this.picture.style.transform.indexOf("scale(0.7)")>=0?`perspective(${this.perspective}px) scale(0.7)`:`perspective(${this.perspective}px)`,this.figures.forEach(e=>e.el.style.transform="null"),this.x=this.y=0}}new Picture(pictureList[0]);